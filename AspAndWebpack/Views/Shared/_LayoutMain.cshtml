@using IHS.Apps.CMP.Security
@using IHS.Apps.CMP.Web.Classes;
<!DOCTYPE html>
<!--[if IE 7]>
    <html class="ie7">
<![endif]-->
<!--[if IE 8]>
    <html class="ie8">
<![endif]-->
<!--[if IE 9]>
    <html class="ie9">
<![endif]-->
<!--[if gt IE 9]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="IHS – The Source for Critical Information and Insight">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
    <meta http-equiv="cleartype" content="on">
    <meta name="format-detection" content="telephone=no">

    <link rel="apple-touch-icon" sizes="180x180" href="/Assets/Images/favicons/apple-touch-icon.png?v=IHSM1">
    <link rel="icon" type="image/png" href="/Assets/Images/favicons/favicon-32x32.png?v=IHSM1" sizes="32x32">
    <link rel="icon" type="image/png" href="/Assets/Images/favicons/favicon-16x16.png?v=IHSM1" sizes="16x16">
    <link rel="manifest" href="/Assets/Images/favicons/manifest.json?v=IHSM1">
    <link rel="mask-icon" href="/Assets/Images/favicons/safari-pinned-tab.svg?v=IHSM1" color="#97d700">
    <link rel="shortcut icon" href="/Assets/Images/favicons/favicon.ico?v=IHSM1">
    <link rel="icon" href="/Assets/Images/favicons/favicon.ico?v=IHSM1" type="image/x-icon">
    <meta name="msapplication-config" content="/Assets/Images/favicons/browserconfig.xml?v=IHSM1">
    <meta name="theme-color" content="#ffffff">

    <title>
        @if (IsSectionDefined("browser_title"))
        {
            @RenderSection("browser_title", required: false)
        }
        else
        {
            @ViewBag.Title
        }
    </title>

    @*<!-- ESSENTIAL SCRIPTS-->*@
    @*<!-- These scripts are considered essential to the loading of the page, so these are located in the header -->*@

    <!--[if IE 7]>
        @Scripts.Render("~/bundles/json2")
    <![endif]-->
    @Scripts.Render("~/bundles/jquery")
    <!-- CDN Failover for JQuery -->
    <script type="text/javascript">
        if (typeof jQuery == 'undefined') {
            var e = document.createElement('script');
            e.src = '@Url.Content("~/Assets/Javascript/Plugins/jquery-1.11.0.min.js")';
            e.type = 'text/javascript';
            document.getElementsByTagName("head")[0].appendChild(e);
        }
    </script>

    @Scripts.Render("~/bundles/jqueryui")
    <!-- CDN Failover for JQuery UI -->
    <script type="text/javascript">
        if (typeof jQuery == 'undefined') {
            var e = document.createElement('script');
            e.src = '@Url.Content("~/Assets/Javascript/Plugins/jquery-ui-1.12.0.min.js")';
            e.type = 'text/javascript';
            document.getElementsByTagName("head")[0].appendChild(e);
        }
    </script>

    @Styles.Render("~/Content/mainCss")

    <!--[if lte IE 7]>
        @Styles.Render("~/Content/ie7Css")
    <![endif]-->
    <!--[if lte IE 8]>
        @Styles.Render("~/Content/ie8Css")
    @Scripts.Render("~/bundles/ie7-8")
    <![endif]-->

    @RenderSection("additional_css", required: false)   
</head>
<body class="@this.ViewBag.BodyClass">
    
    @if (ViewBag.ShowMenuFade != null && ViewBag.ShowMenuFade)
    { 
        <span class="menuFade"></span>
    }
    <a id="scroll-to-top" href="#" aria-label="Scroll to top"></a>
    <header class="ihs-header-cmp navbar navbar-default navbar-static-top position-fixed-x @(this.ViewBag.HeaderClass??string.Empty)">
    @Html.Action("PopulateBanner", "Banner", new ViewDataDictionary { { "vb", ViewBag } })
    @if (IsSectionDefined("my_banner"))
    {
        <nav class="ihs-menu">
            <div id="mainNav" class="navbar-nav">
                <button class="menu-button hidden-print" aria-haspopup="true" tabindex="0">
                    Menu
                    <span class="caret"></span>
                </button>
                <ul class="nav-bar" role="menubar" style="float: right;">
                    @RenderSection("my_banner", required: false)
                    <li class="nav-more nav-item " ><a href="#">More <span class="caret"></span></a></li>
                </ul>
            </div>
        </nav>
    }
    else
    {
        var hasAccess = ViewBag.HasAccess ?? false;
        @Html.Action("PopulateNavBar", "Banner", new { hasAccess = hasAccess, activeKey = ViewBag.ActiveBannerKey })
    }
        
    </header>

    @{
        var uiMessageUtilSession = new UIMessageUtil(Context, UIMessageUtil.MessageScope.Both);
        var messages = uiMessageUtilSession.GetMessages();
    }
    @if (messages != null && messages.Any())
    {
        foreach (var message in messages)
        {
            var alertType = "alert-info";
            switch (message.MessageType)
            {
                case UIMessage.UiMessageType.Warning:
                    {
                        alertType = "alert-warning";
                        break;
                    }
                default:
                    {
                        break;
                    }
            }
            <div class="message alert @alertType" role="alert" style="margin: 0 -2.6%; padding: 4px 2.6%; width: 105.2%;">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true" onclick="closeMessage('@message.Name')">×</span></button>   
            @Html.Raw(message.Message)
        </div>
        }

    }

    @RenderSection("page_title", required: false)

    <div id="container" role="main">
    @if (ViewBag.HasAccess == null || !ViewBag.HasAccess)
    {
        var warning = ViewBag.AuthorizationWarningType ?? AuthWarningType.None;
        @Html.Action("PopulateNoAccess", "NoAccess", new { warningType = warning, titleOnly = false })
    }
    else
    {
        @RenderBody()
    }
    </div>

    @Html.Action("PopulateFooter", "Footer")

    @RenderSection("additional_markup", required: false)

    <div id="quickMessage" class="alert alert-dismissable alert-success">
        <button class="close" type="button" data-dismiss="alert">×</button>
        <span id="quickMessageText"></span>
    </div>

    <div id="notifications" class="notifications">
        <div id="divNotificationsClose" class="notificationsClose" onclick="CloseNotifications();"></div>
        <div id="divNotificationsTitle" class="notificationsTitle">Notifications</div>
        <div id="divNotificationsSwitchOff" class="notificationsSwitchOff"><a href="#" onclick="SwitchOffNotifications();">Switch Off</a></div>
        <div id="divNotificationsContent" class="notificationsContent"></div>
    </div>

    <div class="modal fade" id="generalDialog" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <i class="icon-move pull-left"></i>
                    <button class="modal-expand pull-right actionable icon-resize-full"></button>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <!-- help indicator dialog -->
    <div class="modal fade" id="helpIndicatorDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <a class="tipsyMe helpIndicatorDownloadLink pull-right" title="Download Help" target="new"><i class="icon-file-pdf"></i></a>
                    <h4 class="helpIndicatorTitle modal-title"></h4>
                </div>
                <div class="helpIndicatorContent modal-body">
                </div>
                <ul class="helpIndicatorList"></ul>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="ShareDialog"></div>

    <!-- Image Popup display -->
    <div id="imgPopupWrapper" style="display: none;">
        <div class="titleBar">
            <div class="close"></div>
            <div class="fullscreen"></div>
        </div>
        <div class="wait">Please wait...</div>
        <div class="viewer"></div>
    </div>

    <div class="mainLoadingOverlay loadingOverlay" style="display:none;">
        <div class="loading dimmer"></div>        
    </div>

    <!--SCRIPTS ONLY BELOW HERE -->

    <script src="@Url.Content("~/Assets/Javascript/Localisation/Strings." + System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName + ".js")" type="text/javascript"></script>

    @*Used for the MySubscriptions Partial View located within banner and other sub pages*@
    <script src="/Assets/Javascript/FavouriteCategories.js"></script>

    @Scripts.Render("~/bundles/knockout")
    @Scripts.Render("~/bundles/mainJs")
    @Scripts.Render("~/bundles/searchBar")
    @Scripts.Render("~/bundles/accessibility")
    @Scripts.Render("~/bundles/jqueryUnobtrusive")

    @Html.Action("Register", "GoogleAnalytics")

    @if (this.UserProfile.ActivateReportBuilder && this.User.AccountType == IHS.Apps.CMP.Models.Security.AccountType.Individual)
    {
        <script data-rb-sessionid="@this.User.SessionId" data-rb-product="@this.ViewBag.ApplicationName" data-rb-content="#mainContent,  .result-item" src="@(CMPConfiguration.ReportBuilderUrl)"></script>
    }

    @* 
        If the current user does not have access to the current page then do not render the aditional scripts. 
        These scripts may cause additional server hits in the background which are not required
    *@

    @if (ViewBag.HasAccess != null && ViewBag.HasAccess)
    {
        @RenderSection("additional_scripts", required: false)
    }
    else
    {
        WriteTo(TextWriter.Null, RenderSection("additional_scripts", false));
    }

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400" rel="stylesheet">
</body>
</html>